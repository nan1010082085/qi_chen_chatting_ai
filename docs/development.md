# å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£ä¸ºå¼€å‘è€…æä¾›è¯¦ç»†çš„æŠ€æœ¯æŒ‡å—ï¼ŒåŒ…æ‹¬é¡¹ç›®æ¶æ„ã€å¼€å‘ç¯å¢ƒæ­å»ºã€ä»£ç è§„èŒƒç­‰ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**ï¼šVue 3 + Composition API
- **ç±»å‹ç³»ç»Ÿ**ï¼šTypeScript
- **æ„å»ºå·¥å…·**ï¼šVite
- **UI ç»„ä»¶åº“**ï¼šTDesign Vue Next
- **çŠ¶æ€ç®¡ç†**ï¼šPinia
- **æ ·å¼æ–¹æ¡ˆ**ï¼šUnoCSS + SCSS
- **AI é›†æˆ**ï¼šLangChain.js
- **æ•°æ®å­˜å‚¨**ï¼šIndexedDB
- **ä»£ç è§„èŒƒ**ï¼šESLint + Prettier
- **æµ‹è¯•æ¡†æ¶**ï¼šVitest

### ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ components/          # ç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ chat/           # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ sidebar/        # ä¾§è¾¹æ ç»„ä»¶
â”‚   â””â”€â”€ common/         # é€šç”¨ç»„ä»¶
â”œâ”€â”€ views/              # é¡µé¢è§†å›¾
â”‚   â””â”€â”€ ChatView.vue    # ä¸»èŠå¤©é¡µé¢
â”œâ”€â”€ stores/             # Pinia çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ chat.ts         # èŠå¤©çŠ¶æ€ç®¡ç†
â”œâ”€â”€ services/           # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ deepseek.ts     # DeepSeek AI æœåŠ¡
â”‚   â””â”€â”€ indexedDB.ts    # æ•°æ®åº“æœåŠ¡
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ types/              # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ assets/             # é™æ€èµ„æº
â””â”€â”€ styles/             # æ ·å¼æ–‡ä»¶
```

### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vue 3 Views   â”‚  â† ç”¨æˆ·ç•Œé¢å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Components    â”‚  â† ç»„ä»¶å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pinia Stores   â”‚  â† çŠ¶æ€ç®¡ç†å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Services     â”‚  â† æœåŠ¡å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IndexedDB     â”‚  â† æ•°æ®æŒä¹…åŒ–å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒ

### ç¯å¢ƒè¦æ±‚
- **Node.js**ï¼š>= 16.0.0
- **npm**ï¼š>= 8.0.0 æˆ– **yarn**ï¼š>= 1.22.0
- **ç°ä»£æµè§ˆå™¨**ï¼šæ”¯æŒ ES2020+ çš„æµè§ˆå™¨

### å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨ npm
npm install

# æˆ–ä½¿ç”¨ yarn
yarn install
```

### å¼€å‘å‘½ä»¤
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆç”Ÿäº§æ„å»º
npm run preview

# è¿è¡Œæµ‹è¯•
npm run test

# ä»£ç æ£€æŸ¥
npm run lint

# ä»£ç æ ¼å¼åŒ–
npm run format

# ç±»å‹æ£€æŸ¥
npm run type-check
```

### ç¯å¢ƒé…ç½®
åˆ›å»º `.env.local` æ–‡ä»¶è¿›è¡Œæœ¬åœ°å¼€å‘é…ç½®ï¼š

```env
# å¼€å‘ç¯å¢ƒé…ç½®
VITE_APP_TITLE=AIèŠå¤©åŠ©æ‰‹ï¼ˆå¼€å‘ç‰ˆï¼‰
VITE_OPENAI_API_KEY=your_dev_api_key
VITE_API_BASE_URL=https://api.siliconflow.cn/v1
VITE_DEFAULT_MODEL=deepseek-chat
VITE_DEV_TOOLS=true
VITE_DEBUG=true
```

## ğŸ“ ä»£ç è§„èŒƒ

### TypeScript è§„èŒƒ

#### ç±»å‹å®šä¹‰
```typescript
// ä½¿ç”¨ interface å®šä¹‰å¯¹è±¡ç±»å‹
interface ChatMessage {
  id: string;
  content: string;
  role: 'user' | 'assistant';
  timestamp: Date;
}

// ä½¿ç”¨ type å®šä¹‰è”åˆç±»å‹
type MessageStatus = 'sending' | 'sent' | 'error';

// ä½¿ç”¨æ³›å‹æé«˜ä»£ç å¤ç”¨æ€§
interface ApiResponse<T> {
  data: T;
  success: boolean;
  message?: string;
}
```

#### å‡½æ•°å®šä¹‰
```typescript
// æ˜ç¡®çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹
const createMessage = (
  content: string,
  role: ChatMessage['role']
): ChatMessage => {
  return {
    id: generateId(),
    content,
    role,
    timestamp: new Date()
  };
};

// å¼‚æ­¥å‡½æ•°çš„ç±»å‹å®šä¹‰
const saveMessage = async (
  message: ChatMessage
): Promise<void> => {
  await indexedDBService.saveMessage(message);
};
```

### Vue 3 è§„èŒƒ

#### Composition API
```vue
<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import type { ChatMessage } from '@/types';

// å“åº”å¼æ•°æ®
const messages = ref<ChatMessage[]>([]);
const isLoading = ref(false);

// è®¡ç®—å±æ€§
const messageCount = computed(() => messages.value.length);

// æ–¹æ³•
const addMessage = (message: ChatMessage) => {
  messages.value.push(message);
};

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadMessages();
});
</script>
```

#### ç»„ä»¶å‘½å
```typescript
// ç»„ä»¶æ–‡ä»¶åä½¿ç”¨ PascalCase
// ChatSidebar.vue
// MessageInput.vue
// UserAvatar.vue

// ç»„ä»¶å†…éƒ¨ä½¿ç”¨ kebab-case
<template>
  <div class="chat-sidebar">
    <message-input @send="handleSend" />
    <user-avatar :user="currentUser" />
  </div>
</template>
```

### CSS è§„èŒƒ

#### ç±»åå‘½å
```scss
// ä½¿ç”¨ BEM å‘½åè§„èŒƒ
.chat-sidebar {
  &__header {
    // æ ·å¼
  }
  
  &__content {
    // æ ·å¼
  }
  
  &__item {
    &--active {
      // ä¿®é¥°ç¬¦æ ·å¼
    }
  }
}
```

#### UnoCSS ä½¿ç”¨
```vue
<template>
  <!-- ä¼˜å…ˆä½¿ç”¨ UnoCSS åŸå­ç±» -->
  <div class="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm">
    <!-- å¤æ‚æ ·å¼ä½¿ç”¨è‡ªå®šä¹‰ç±» -->
    <div class="chat-message">
      <!-- å†…å®¹ -->
    </div>
  </div>
</template>

<style scoped>
/* è‡ªå®šä¹‰æ ·å¼è¡¥å…… UnoCSS ä¸è¶³ */
.chat-message {
  /* å¤æ‚çš„è‡ªå®šä¹‰æ ·å¼ */
}
</style>
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—å¼€å‘

### çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

#### Store å®šä¹‰
```typescript
// stores/chat.ts
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import type { ChatSession, ChatMessage } from '@/types';

export const useChatStore = defineStore('chat', () => {
  // çŠ¶æ€
  const sessions = ref<ChatSession[]>([]);
  const currentSessionId = ref<string | null>(null);
  
  // è®¡ç®—å±æ€§
  const currentSession = computed(() => 
    sessions.value.find(s => s.id === currentSessionId.value)
  );
  
  // æ–¹æ³•
  const createSession = async (): Promise<string> => {
    // å®ç°é€»è¾‘
  };
  
  const addMessage = async (
    content: string, 
    role: ChatMessage['role']
  ): Promise<string> => {
    // å®ç°é€»è¾‘
  };
  
  return {
    // å¯¼å‡ºçŠ¶æ€ã€è®¡ç®—å±æ€§å’Œæ–¹æ³•
    sessions,
    currentSessionId,
    currentSession,
    createSession,
    addMessage
  };
});
```

#### Store ä½¿ç”¨
```vue
<script setup lang="ts">
import { useChatStore } from '@/stores/chat';

const chatStore = useChatStore();

// ä½¿ç”¨çŠ¶æ€
const { sessions, currentSession } = storeToRefs(chatStore);

// è°ƒç”¨æ–¹æ³•
const handleSend = async (content: string) => {
  await chatStore.addMessage(content, 'user');
};
</script>
```

### æœåŠ¡å±‚å¼€å‘

#### AI æœåŠ¡
```typescript
// services/deepseek.ts
import { ChatOpenAI } from '@langchain/openai';
import type { BaseMessage } from '@langchain/core/messages';

export class DeepSeekService {
  private client: ChatOpenAI;
  private config: DeepSeekConfig;
  
  constructor(config: DeepSeekConfig) {
    this.config = config;
    this.client = new ChatOpenAI({
      openAIApiKey: config.apiKey,
      modelName: config.model,
      temperature: config.temperature,
      // ... å…¶ä»–é…ç½®
    });
  }
  
  async sendMessage(
    messages: ChatMessage[],
    options?: SendMessageOptions
  ): Promise<string> {
    // å®ç°æ¶ˆæ¯å‘é€é€»è¾‘
  }
  
  updateConfig(newConfig: Partial<DeepSeekConfig>): void {
    // æ›´æ–°é…ç½®é€»è¾‘
  }
}
```

#### æ•°æ®åº“æœåŠ¡
```typescript
// services/indexedDB.ts
export class IndexedDBService {
  private db: IDBDatabase | null = null;
  private readonly dbName = 'ChatAppDB';
  private readonly version = 1;
  
  async initDB(): Promise<void> {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, this.version);
      
      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.db = request.result;
        resolve();
      };
      
      request.onupgradeneeded = (event) => {
        // æ•°æ®åº“å‡çº§é€»è¾‘
      };
    });
  }
  
  async saveSession(session: ChatSession): Promise<void> {
    // ä¿å­˜ä¼šè¯é€»è¾‘
  }
}
```

### ç»„ä»¶å¼€å‘

#### ç»„ä»¶ç»“æ„
```vue
<!-- components/chat/MessageItem.vue -->
<template>
  <div class="message-item" :class="messageClasses">
    <div class="message-item__avatar">
      <img :src="avatarUrl" :alt="senderName" />
    </div>
    
    <div class="message-item__content">
      <div class="message-item__header">
        <span class="message-item__sender">{{ senderName }}</span>
        <span class="message-item__time">{{ formattedTime }}</span>
      </div>
      
      <div class="message-item__body">
        <div v-if="message.reasoning" class="message-reasoning">
          {{ message.reasoning }}
        </div>
        <div class="message-content">
          {{ message.content }}
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import type { ChatMessage } from '@/types';
import { formatTime } from '@/utils';

interface Props {
  message: ChatMessage;
}

const props = defineProps<Props>();

// è®¡ç®—å±æ€§
const messageClasses = computed(() => ({
  'message-item--user': props.message.role === 'user',
  'message-item--assistant': props.message.role === 'assistant',
  'message-item--error': props.message.status === 'error'
}));

const avatarUrl = computed(() => 
  props.message.role === 'user' ? '/user-avatar.png' : '/ai-avatar.png'
);

const senderName = computed(() => 
  props.message.role === 'user' ? 'ç”¨æˆ·' : 'AI åŠ©æ‰‹'
);

const formattedTime = computed(() => 
  formatTime(props.message.timestamp)
);
</script>

<style scoped>
.message-item {
  @apply flex gap-3 p-4;
  
  &--user {
    @apply flex-row-reverse;
  }
  
  &__avatar img {
    @apply w-8 h-8 rounded-full;
  }
  
  &__content {
    @apply flex-1 max-w-0;
  }
  
  &__header {
    @apply flex items-center justify-between mb-1;
  }
  
  &__sender {
    @apply text-sm font-medium text-gray-700;
  }
  
  &__time {
    @apply text-xs text-gray-500;
  }
}

.message-reasoning {
  @apply p-3 mb-2 bg-blue-50 rounded-lg text-sm text-blue-800;
  border-left: 3px solid theme('colors.blue.400');
}

.message-content {
  @apply text-gray-900 leading-relaxed;
}
</style>
```

## ğŸ§ª æµ‹è¯•å¼€å‘

### å•å…ƒæµ‹è¯•
```typescript
// tests/stores/chat.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { setActivePinia, createPinia } from 'pinia';
import { useChatStore } from '@/stores/chat';

describe('Chat Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia());
  });
  
  it('should create a new session', async () => {
    const store = useChatStore();
    const sessionId = await store.createSession();
    
    expect(sessionId).toBeTruthy();
    expect(store.sessions).toHaveLength(1);
    expect(store.currentSessionId).toBe(sessionId);
  });
  
  it('should add message to current session', async () => {
    const store = useChatStore();
    await store.createSession();
    
    const messageId = await store.addMessage('Hello', 'user');
    
    expect(messageId).toBeTruthy();
    expect(store.currentSession?.messages).toHaveLength(1);
    expect(store.currentSession?.messages[0].content).toBe('Hello');
  });
});
```

### ç»„ä»¶æµ‹è¯•
```typescript
// tests/components/MessageItem.test.ts
import { describe, it, expect } from 'vitest';
import { mount } from '@vue/test-utils';
import MessageItem from '@/components/chat/MessageItem.vue';
import type { ChatMessage } from '@/types';

describe('MessageItem', () => {
  const mockMessage: ChatMessage = {
    id: '1',
    content: 'Hello, world!',
    role: 'user',
    timestamp: new Date(),
    status: 'sent'
  };
  
  it('should render message content', () => {
    const wrapper = mount(MessageItem, {
      props: { message: mockMessage }
    });
    
    expect(wrapper.text()).toContain('Hello, world!');
  });
  
  it('should apply correct classes for user message', () => {
    const wrapper = mount(MessageItem, {
      props: { message: mockMessage }
    });
    
    expect(wrapper.classes()).toContain('message-item--user');
  });
});
```

## ğŸš€ æ„å»ºå’Œéƒ¨ç½²

### æ„å»ºé…ç½®
```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  build: {
    target: 'es2020',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'pinia'],
          ui: ['tdesign-vue-next'],
          ai: ['@langchain/openai']
        }
      }
    }
  },
  server: {
    port: 3001,
    open: true
  }
});
```

### Docker éƒ¨ç½²
```dockerfile
# Dockerfile
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### CI/CD é…ç½®
```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm run test
    
    - name: Build
      run: npm run build
    
    - name: Deploy
      # éƒ¨ç½²æ­¥éª¤
```

## ğŸ” è°ƒè¯•å’Œä¼˜åŒ–

### å¼€å‘å·¥å…·
```typescript
// å¼€å‘ç¯å¢ƒå¯ç”¨ Vue DevTools
if (import.meta.env.DEV) {
  import('@vue/devtools');
}

// æ€§èƒ½ç›‘æ§
if (import.meta.env.VITE_DEBUG) {
  console.log('Debug mode enabled');
  
  // æ·»åŠ æ€§èƒ½ç›‘æ§
  window.addEventListener('load', () => {
    console.log('Page load time:', performance.now());
  });
}
```

### æ€§èƒ½ä¼˜åŒ–
```typescript
// ç»„ä»¶æ‡’åŠ è½½
const MessageInput = defineAsyncComponent(
  () => import('@/components/chat/MessageInput.vue')
);

// è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡æ¶ˆæ¯æ—¶ï¼‰
import { VirtualList } from '@tanstack/vue-virtual';

// é˜²æŠ–å¤„ç†
import { debounce } from 'lodash-es';

const debouncedSave = debounce(saveMessage, 300);
```

## ğŸ“š æœ€ä½³å®è·µ

### ä»£ç ç»„ç»‡
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡å‚æ•°ä¼ é€’ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•
3. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ•è·å’Œå¤„ç†æœºåˆ¶
4. **ç±»å‹å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨ TypeScript çš„ç±»å‹ç³»ç»Ÿ

### æ€§èƒ½ä¼˜åŒ–
1. **æ‡’åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½ç»„ä»¶å’Œæ¨¡å—
2. **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¤„ç†å¤§é‡æ•°æ®æ—¶ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
3. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
4. **ä»£ç åˆ†å‰²**ï¼šå°†ä»£ç åˆ†å‰²æˆå¤šä¸ª chunk

### å®‰å…¨è€ƒè™‘
1. **è¾“å…¥éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
2. **XSS é˜²æŠ¤**ï¼šé˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»
3. **API å®‰å…¨**ï¼šä¿æŠ¤ API å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯
4. **å†…å®¹è¿‡æ»¤**ï¼šè¿‡æ»¤ä¸å½“å†…å®¹

---

æ›´å¤šå¼€å‘ç»†èŠ‚è¯·å‚è€ƒæºç æ³¨é‡Šå’Œç›¸å…³æ–‡æ¡£ã€‚